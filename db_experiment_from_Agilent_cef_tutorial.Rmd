---
title: "Creating database-stored experiment from Agilent MSMS search results"
---

This section of the manual is walking through the process of uploading MSMS data. At the moment, only MSMS data generated by Agilent instruments and extracted into Agilent CEF format are supported. The data used as example in this manual were obtained by iterative data-dependent MSMS acquisition (iDDA) using one sample, but the same process can be applied to upload MSMS data for multiple distinct samples.

This manual covers the process of creating a new experiment and uploading MSMS data using the wizard. Data upload is a complex multistep process. The goal of the wizard is to ensure that all the necessary information is collected and checked for errors and integrity before it is entered into the database. The wizard guides the process through the following steps:

-   Creating experiment
-   Adding samples
-   Adding sample preparation data
-   Adding data acquisition and data analysis methods
-   Adding instrument worklists
-   Verification of MS/MSMS data
-   Uploading of all collected data to the database

Each step must be completed and verified before the data can be entered at the next step and all steps must be completed and free of errors to complete the data upload. The wizard is intended to create a NEW experiment and upload the MSMS data for it. If you want to add the data to an existing experiment you will have to use individual tools on the "IDTracker LIMS" tab.

# iDDA data upload Wizard

## Wizard-guided workflow

Start MRC2 data analysis software and switch to "IDTracker LIMS" tab. Login into ID tracker by clicking ![](assets/images/5bf92be9f759.034.png) icon on the right side of the main software toolbar and entering your METLims or ID tracker username and password in the dialog. If login is successful, the system will fetch the current data from the database to populate the different tables and the login icon will change to ![](assets/images/5bf92be9f759.035.png) followed by your name. To open the wizard dialog (43), click on the ![](assets/images/5bf92be9f759.036.png) icon on the "ID tracker LIMS" tab toolbar. The wizard toolbar contains the buttons that correspond to individual data preparation steps (41).

![](assets/images/5bf92be9f759.037.png)

1.1 *Wizard toolbar*

Clicking on each button loads the corresponding wizard page in the main area of the dialog. The active stage is indicated by the red border around the icon. The user may switch between the screens at any point in the process, but some of the screens may not allow data to be enteredunless previous steps are completed. Each wizard screen has a "Complete '...Step name...'" button in the lower right corner (42) that users must click to verify the entered information and proceed to the next step if there are no errors:

![](assets/images/5bf92be9f759.038.png)

2.2 *Complete step button*

In the bottom left corner of the wizard dialog there is a progress indicator. A red dot indicates an incomplete step. Once the data preparation step is completed and its data verified, the dot color is changed to green (43).

## Experiment definition step

![](assets/images/5bf92be9f759.039.png)

3.3 *Experiment definition screen*

Enter an experiment name (obligatory) and optionally - the description and notes. Select the parent project for the experiment from the dropdown. If you want to add a new project you have to do it in the ID tracker LIMS panel before starting the wizard. Click "Complete experiment definition" button. If there are no errors, organization and contact person fields will be populated automatically and the screen for the next stage will be loaded.

## Adding samples to the experiment

At this stage you must add one or more samples (aliquots) to the experiment. MSMS is performed either on aliquots of samples prepared specifically for this purpose (like MoTrPAC reference tissue types, CHEAR plasma urine, etc.) or pooled samples from MRC2 client experiments. For this reason, ID Tracker samples are handled differently than regular LIMS samples using a two-tier system that includes stock samples and aliquots created from them. Stock samples hold the information about the origin of the sample (tissue type, species, LIMS experiment if available), aliquot references the stock sample for this information and represents a small portion of the stock sample prepared for the specific compound identification experiment.

You may add new aliquots either based on existing stock samples or create new stock samples and then add aliquots based on them.

### Create the aliquot from existing stock sample

To create the aliquot from existing stock sample, click the ![](assets/images/5bf92be9f759.040.png) icon on the "Add samples" panel toolbar to show "Add new sample" dialog. Click "Select stock sample" button in the upper right corner of the dialog to show the list of available stock samples. You may use the filters in the table header to quickly find samples by name, description, etc. Select the sample in the table and click the "Select stock sample" button in the lower right corner of the dialog (44).

![](assets/images/5bf92be9f759.041.png)

4.4 *Creating aliquot from existing stock sample*

The "Add new sample" dialog fields will be automatically populated with the data for the selected stock sample (45). You may change the name and description of the sample at this point.

![](assets/images/5bf92be9f759.042.png)

5.5 *New sample definition dialog*

Click "Add sample" to complete the sample definition and add it to the experiment. The sample will appear in the experiment sample list (46)

![](assets/images/5bf92be9f759.043.png)

6.6 *Experiment sample list*

To edit the sample name and description select the sample in the table and click the ![](assets/images/5bf92be9f759.044.png) button to show the "Edit sample" dialog (45). To delete the sample from experiment select it in the table and click the![](assets/images/5bf92be9f759.045.png) button.

### Create new stock sample

To create a new stock sample, click the ![](assets/images/5bf92be9f759.046.png) icon on the on the "Add samples" panel toolbar to show the "Add new stock sample" dialog (47).

![](assets/images/5bf92be9f759.047.png)

7.7 *Add new stock sample dialog*

Provide the sample name and description. External source and ID are optional and may be useful for inter-laboratory data exchange (e.g. MoTrPAC reference sample IDs). Sample type and species are obligatory. Click "Select sample type" / "Select species" to display one of corresponding dialogs. The table in "Select sample type" dialog (48) will be pre-populated with data for previously analyzed samples. If it doesn't contain the sample type of interest you may use the search function (at the top of the dialog). Search is based on partial match, search string has to be at least 4 characters long.

![](assets/images/5bf92be9f759.048.png)

8.8 *Sample type lookup*

The table in "Select species" dialog (49) will be pre-populated with data for previously analyzed samples. If it doesn't contain the species of interest, you may use the search function (at the top of the dialog). Search is based on partial match, search string has to be at least 4 characters long.

![](assets/images/5bf92be9f759.049.png)

9.9 *Species lookup dialog*

After the sample type and species are defined, click "Save" to add a new stock sample to the database (410). After that you may use the process described in the previous section to add an aliquot of this stock sample to your new experiment.

![](assets/images/5bf92be9f759.050.png)

10.10 *Defined stock sample*

You may add multiple aliquots of different samples to the experiment one at a time. After you have added all of the required aliquots, click the "Complete sample list definition" button to verify the data and move to the next step. The only obligatory requirement to the "Add samples" step is that there should be at least one sample in the list.

## Adding sample preparation information

"Add sample preparation" panel (411) has several sections. The sample list table will be populated automatically based on the data entered on the previous steps. Sample prep name, "Prepared by", date of preparation, and at least one SOP protocol are obligatory to complete the sample prep definition step. To set the date click on the button next to the "Prepared on" field and select the date from the popup calendar (411). To select the user responsible for this sample preparation, click the "Select user" button to show the user selection dialog. Highlight the user in the table and click "Select user" (412).

![](assets/images/5bf92be9f759.051.png)

11.11 *Sample preparation panel*

![](assets/images/5bf92be9f759.052.png)

12.12 *User selector*

To add SOPs switch to the "SOP protocols" tab and click ![](assets/images/5bf92be9f759.053.png) button to display the list of available SOPs (413). You may use the filters in the table header to narrow down the list and find the required SOPs. Select one or more SOPs that you would like to add and click the "Add selected protocols" button.

![](assets/images/5bf92be9f759.054.png)

13.13 *Adding SOPs*

After all of the required prep information was added click the "Complete sample preparation definition" button to save the prep data and move to the next step.

## Adding data acquisition and data analysis methods

### Adding data acquisition methods

There are three ways to add the data acquisition methods to the experiment:

-   By scanning the raw data directories
-   By choosing the existing methods from the database manually
-   By manually defining and uploading the new methods

#### Adding acquisition methods using raw data directory scan

Click ![](assets/images/5bf92be9f759.055.png) icon on the "Data acquisition methods" section toolbar of the wizard screen (414) and select the directory containing the raw data files in the file explorer. Click "Open" to scan the directory for acquisition methods. The scan is NOT recursive, so if you have separate directories for positive and negative mode data you must scan each of them. All found methods will be added to the table. If the method is already in the database, DB ID column will have the corresponding ID.

![](assets/images/5bf92be9f759.056.png)

14.14 *Data acquisition and data analysis method manager*

If DB ID column is empty, you must add the method to the database. To do it select the method without DB ID in the table and click ![](assets/images/5bf92be9f759.057.png) button on the toolbar to open the new method definition dialog (415). Method name, description and path to method file will be populated automatically. All the fields in the method editor must be defined to save the method. Click "Save" to save a new method to the database. The methods table will be updated, and the DB ID column will now contain the ID for the method (416).

![](assets/images/5bf92be9f759.058.png)

15.15 *Acquisition method editor dialog*

![](assets/images/5bf92be9f759.059.png)

16.16 *Newly defined method*

#### Select existing method from the database

If you know exactly which method(s) were used for data acquisition you may manually select them from the database (one at a time). Click ![](assets/images/5bf92be9f759.057.png) button on the data acquisition section toolbar to show method selector (417). You may use table header filters to find the method. Select the method in the table and click the "Select data acquisition method" button to add it to the experiment.

![](assets/images/5bf92be9f759.060.png)

17.17 *Acquisition method list*

#### Manually define new acquisition method

Click the ![](assets/images/5bf92be9f759.057.png) button on the data acquisition section toolbar to show the method editor (415). Use the "Method file" button to navigate to the method folder. Method name will be auto-populated using method file name and cannot be edited. Complete all the necessary information and click "Save" to save the method to the database and add it to the experiment.

### Adding data analysis methods

There are two ways to add the data analysis methods to the experiment:

-   By choosing the existing methods from the database manually
-   By manually defining and uploading the new methods

#### Select existing method from the database

If you know exactly which method(s) were used for data analysis you may manually select them from the database (one at a time). Click the ![](assets/images/5bf92be9f759.057.png) button on the data analysis section toolbar to show method selector (418). You may use table header filters to find the method. Select the method in the table and click the "Select data analysis method" button to add it to the experiment.

![](assets/images/5bf92be9f759.061.png)

18.18 *Data analysis method list*

#### Manually define new data analysis method

Click the ![](assets/images/5bf92be9f759.057.png) button on the data acquisition section toolbar to show the method editor (415). Use the "Method file" button to navigate to the method folder. The method name will be auto-populated using method file name and cannot be edited. Click "Save" to save the method to the database and add it to the experiment.

After all the necessary methods were added click the "Complete analysis methods definition" button to save the data and move to the next step.

## Adding instrument worklist data

Worklist data (raw data file names, acquisition methods, file names, etc.) are obtained by scanning the directories containing raw data the same way they are scanned to collect acquisition method data. Directory scans are not recursive, so if there is more than one directory with raw data files from the current experiment (e.g. positive and negative mode) they all should be scanned individually. During the scan acquisition method for each data file is checked against the list defined at the previous step. When directory scan is completed information for all data files is entered into the table (419). If any of the detected acquisition methods was not previously added to the experiment the user is given a choice:

-   ignore raw data files that are using the missing methods
-   cancel worklist import, return to methods screen, and add the missing methods

![](assets/images/5bf92be9f759.062.png)

19.19 *Worklist data panel*

The icon ![](assets/images/5bf92be9f759.057.png) is used to add the first batch of data (if any data are already in the table, they will be replaced). To add more data files to the list, use the ![](assets/images/5bf92be9f759.057.png) icon. Duplicate files will be ignored, so there is no possibility of entering duplicate data by accidentally scanning the same folder more than once.

To complete the worklist import step it is necessary to assign samples to data files. To do that select all the files in the table that correspond to the same sample, right click to show the context menu, and select "Edit design for selected samples" (419). In the new dialog select the sample from the dropdown, prep item will be populated automatically (420). After all data files have been linked to the samples click the "Complete worklist verification" button to save the data and move to the next step.

![](assets/images/5bf92be9f759.063.png)

20.20 *Assign sample to data files dialog*

## MSMS data verification

This step is necessary to ensure that any MSMS data that contain compound identification information (e.g. were matched against a MSMS library as a part of data extraction process) can be properly matched to the local MetIDTracker compound database.

![](assets/images/5bf92be9f759.064.png)

421 *MSMS data verification panel*

Use the ![](assets/images/5bf92be9f759.057.png) button to select CEF files containing MSMS data. Data may be added from multiple folders, duplicate file names will be ignored. CEF files will be matched to raw data files by name. The data analysis method must be specified for every data file. Select all of the files processed with the same data analysis method, right-click and select "Select data analysis method for selected files" from the context menu (\*4\*\*21\*). In the new dialog select the method from the dropdown and click "Assign method" (422).

![](assets/images/5bf92be9f759.065.png)

22.22 *Data analysis method assignment dialog*

To check for missing compound IDs click the ![](assets/images/5bf92be9f759.057.png) button on the panel toolbar. The progress window will appear. It may take some time to run the checks. The time depends on the number of files and the number of features in each file. If any new library entries will be uploaded to the MSMS database during the pre-scan of the data and/or if any of the compound IDs can't be matched to the compound database this information will be displayed in the "Data prescan details" dialog. Unmatched compound IDs will prevent the correct data upload, so if they are present, please copy the log and use it to edit/extend compound database (//**TODO** needs section in the manual). Otherwise at this point the experiment is fully defined. Click the "Complete data verification" button to save these step results and then the - "Upload data" button in the lower right corner of the wizard to start the actual data upload process.
